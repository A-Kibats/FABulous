<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>Fabric definition &#8212; FABulous Dokumentation 0.1 documentation</title>

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/material-icons.css" />
    <link rel="stylesheet" href="_static/notosanscjkjp.css" type="text/css" />
    <link rel="stylesheet" href="_static/roboto.css" type="text/css" />
    <link rel="stylesheet" href="_static/material-design-lite-1.3.0/material.indigo-pink.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx_materialdesign_theme.css" type="text/css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_materialdesign_theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fabric ASIC implementation" href="ASIC/index.html" />
    <link rel="prev" title="Building fabric" href="Building%20fabric.html" /> 
  </head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer"><header class="mdl-layout__header mdl-layout__header--waterfall ">
    <div class="mdl-layout__header-row">
        
        <nav class="mdl-navigation breadcrumb">
            <a class="mdl-navigation__link is-active">Fabric definition</a>
        </nav>
        <div class="mdl-layout-spacer"></div>
        <nav class="mdl-navigation">
        
<form class="form-inline pull-sm-right" action="search.html" method="get">
      <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable mdl-textfield--floating-label mdl-textfield--align-right">
        <label id="quick-search-icon" class="mdl-button mdl-js-button mdl-button--icon"  for="waterfall-exp">
            <i class="material-icons">search</i>
        </label>
        <div class="mdl-textfield__expandable-holder">
          <input class="mdl-textfield__input" type="text" name="q"  id="waterfall-exp" placeholder="Search" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </div>
      </div>
      <div class="mdl-tooltip" data-mdl-for="quick-search-icon">
      Quick search
      </div>
</form>
        
<a id="button-show-source"
    class="mdl-button mdl-js-button mdl-button--icon"
    href="_sources/fabric_definition.rst.txt" rel="nofollow">
<i class="material-icons">code</i>
</a>
<div class="mdl-tooltip" data-mdl-for="button-show-source">
Show Source
</div>
        </nav>
    </div>
    <div class="mdl-layout__header-row header-links">
      <div class="mdl-layout-spacer"></div>
      <nav class="mdl-navigation">
      </nav>
    </div>
</header><header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="index.html">
              <img class="logo" src="_static/FAB_logo.png" alt="FABulous Dokumentation"/>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <ul>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background and Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Usage.html">Quick start</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Building%20fabric.html">Building fabric</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fabric definition</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ASIC/index.html">Fabric ASIC implementation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FPGA_CAD-tools/index.html">FPGA CAD-tool parameterization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="FPGA_CAD-tools/yosys.html">Yosys models</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA_CAD-tools/nextpnr.html">Nextpnr models</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA_CAD-tools/vpr.html">VPR models</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FPGA-to-bitstream/index.html">RTL to Bitstream</a><ul>
<li class="toctree-l2"><a class="reference internal" href="FPGA-to-bitstream/Yosys%20compilation.html">Yosys compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA-to-bitstream/Nextpnr%20compilation.html">Nextpnr compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA-to-bitstream/VPR%20compilation.html">VPR compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA-to-bitstream/Bitstream%20generation.html">Bitstream generation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="simulation/index.html">Simulation and emulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simulation/simulation.html">Simulation setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation/emulation.html">Emulation setup</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references/index.html">Technical references</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gallery/index.html">Chip Gallery</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="definitions.html">Definitions and abbreviations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Team and contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
</ul>

            </nav>
        
        </div>
    
</header>
        <main class="mdl-layout__content" tabIndex="0">
<header class="mdl-layout__drawer">
    
          <!-- Title -->
      <span class="mdl-layout-title">
          <a class="title" href="index.html">
              <img class="logo" src="_static/FAB_logo.png" alt="FABulous Dokumentation"/>
          </a>
      </span>
    
    
      <div class="globaltoc">
        <span class="mdl-layout-title toc">Table Of Contents</span>
        
        
            
            <nav class="mdl-navigation">
                <ul>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background and Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Usage.html">Quick start</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Building%20fabric.html">Building fabric</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fabric definition</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ASIC/index.html">Fabric ASIC implementation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FPGA_CAD-tools/index.html">FPGA CAD-tool parameterization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="FPGA_CAD-tools/yosys.html">Yosys models</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA_CAD-tools/nextpnr.html">Nextpnr models</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA_CAD-tools/vpr.html">VPR models</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FPGA-to-bitstream/index.html">RTL to Bitstream</a><ul>
<li class="toctree-l2"><a class="reference internal" href="FPGA-to-bitstream/Yosys%20compilation.html">Yosys compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA-to-bitstream/Nextpnr%20compilation.html">Nextpnr compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA-to-bitstream/VPR%20compilation.html">VPR compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="FPGA-to-bitstream/Bitstream%20generation.html">Bitstream generation</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="simulation/index.html">Simulation and emulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="simulation/simulation.html">Simulation setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulation/emulation.html">Emulation setup</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references/index.html">Technical references</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gallery/index.html">Chip Gallery</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="definitions.html">Definitions and abbreviations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Team and contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
</ul>

            </nav>
        
        </div>
    
</header>

    <div class="document">
        <div class="page-content">
        
  <section id="fabric-definition">
<h1>Fabric definition<a class="headerlink" href="#fabric-definition" title="Permalink to this headline">Â¶</a></h1>
<p>This section describes the process of modeling FABulous fabrics in a top-down manner.
FABulous can reuse preimplemented tiles which allows it to define fabrics in a LEGO-like manner where it is sufficient to define the <a class="reference internal" href="#fabric-layout"><span class="std std-ref">Fabric layout</span></a> in terms of IO and logic tiles or any other required block.</p>
<p>For customization of <a class="reference internal" href="#tiles"><span class="std std-ref">Tiles</span></a> or the creation of new blocks, it is possible to model the routing <a class="reference internal" href="#wires"><span class="std std-ref">Wires</span></a>, a central <a class="reference internal" href="#switch-matrix"><span class="std std-ref">Switch matrix</span></a> and <a class="reference internal" href="#primitives"><span class="std std-ref">Primitives</span></a></p>
<p>The following figure shows a small fabric, which we will model throughout this section. It provides:</p>
<ul class="simple">
<li><p>4x IO pins</p></li>
<li><p>4x Register file slices</p></li>
<li><p>2 DSP block supertiles</p></li>
<li><p>4 internal IO ports for coupling the fabric with a CPU</p></li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/abstract_tile_view.png"><img alt="FABulous example fabric" src="_images/abstract_tile_view.png" style="width: 33%;" /></a>
</figure>
<p>The full model of a fabric is described by the following files:</p>
<ul class="simple">
<li><p>A file <a class="reference internal" href="#fabric-csv"><span class="std std-ref">Fabric csv description</span></a> providing the <a class="reference internal" href="#fabric-layout"><span class="std std-ref">Fabric layout</span></a>, some global settings, and the descriptions of the <a class="reference internal" href="#tiles"><span class="std std-ref">Tiles</span></a>-</p></li>
<li><p>A set of list files (*.list) desribing the adjaceny list of the switch matrix for each of the used tiles or the corresponding adjaceny matrix as a csv file</p></li>
<li><p>A set of optional bitstream mapping csv files</p></li>
<li><p>A set of primitives used</p></li>
</ul>
<p>The following block provides a fabric.csv example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">FabricBegin</span>      <span class="c1"># explained in subsection Fabric layout</span>
</span><span class="n">NULL</span><span class="p">,</span>  <span class="n">N_term</span><span class="p">,</span>   <span class="n">N_term</span><span class="p">,</span>   <span class="n">N_term</span><span class="p">,</span>  <span class="n">N_term</span><span class="p">,</span>  <span class="n">NULL</span>
<span class="n">W_IO</span><span class="p">,</span>  <span class="n">RegFile</span><span class="p">,</span>  <span class="n">DSP_top</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">CPU_IO</span>
<span class="n">W_IO</span><span class="p">,</span>  <span class="n">RegFile</span><span class="p">,</span>  <span class="n">DSP_bot</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">CPU_IO</span>
<span class="o">...</span>
<span class="hll"><span class="n">FabricEnd</span>
</span>
<span class="hll"><span class="n">ParametersBegin</span>
</span><span class="n">ConfigBitMode</span><span class="p">,</span> <span class="n">frame_based</span>        <span class="c1"># default is FlipFlopChain</span>
<span class="n">FrameBitsPerRow</span><span class="p">,</span> <span class="mi">32</span>               <span class="c1"># configuration bits per tile row</span>
<span class="n">MaxFramesPerCol</span><span class="p">,</span> <span class="mi">20</span>               <span class="c1"># configuration bits per tile column</span>
<span class="n">Package</span><span class="p">,</span> <span class="n">use</span> <span class="n">work</span><span class="o">.</span><span class="n">my_package</span><span class="o">.</span><span class="n">all</span><span class="p">;</span> <span class="c1"># populate package fiels in VHDL code generation</span>
<span class="n">GenerateDelayInSwitchMatrix</span><span class="p">,</span> <span class="mi">80</span>   <span class="c1"># we can annotate some delay to multiplexers</span>
<span class="n">MultiplexerStyle</span><span class="p">,</span> <span class="n">custom</span>          <span class="c1">#</span>
<span class="hll"><span class="n">ParametersEnd</span>
</span>
<span class="hll"><span class="n">TILE</span><span class="p">,</span> <span class="n">LUT4AB</span>      <span class="c1"># explained in subsection Tiles</span>
</span><span class="c1">#direction  source_name  X-offset  Y-offset  destination_name  wires</span>
<span class="n">NORTH</span><span class="p">,</span>      <span class="n">N1BEG</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>        <span class="n">N1END</span><span class="p">,</span>            <span class="mi">4</span>
<span class="o">...</span>
<span class="n">BEL</span><span class="p">,</span>      <span class="n">LUT4c_frame_config_OQ</span><span class="o">.</span><span class="n">vhdl</span><span class="p">,</span>  <span class="n">LA_</span>
<span class="o">...</span>
<span class="n">MATRIX</span><span class="p">,</span>   <span class="n">LUT4AB_switch_matrix</span><span class="o">.</span><span class="n">vhdl</span>
<span class="hll"><span class="n">EndTILE</span>
</span>
<span class="hll"><span class="n">TILE</span><span class="p">,</span> <span class="n">DSP</span>         <span class="c1"># all other tiles folow the same sheme</span>
</span><span class="o">...</span>
</pre></div>
</div>
<section id="fabric-csv-description">
<span id="fabric-csv"></span><h2>Fabric csv description<a class="headerlink" href="#fabric-csv-description" title="Permalink to this headline">Â¶</a></h2>
<ul>
<li><p>For the part between <code class="docutils literal notranslate"><span class="pre">FabricBegin</span></code> and <code class="docutils literal notranslate"><span class="pre">FabricEnd</span></code>, refer to the <a class="reference internal" href="#fabric-layout"><span class="std std-ref">Fabric layout</span></a> description.</p></li>
<li><p>Empty lines will be ignored as well as everything that follows a <code class="docutils literal notranslate"><span class="pre">#</span></code> (the <strong>comment</strong> symbol in all FABulous descriptions).</p></li>
<li><p>Parameters that relate to the fabric specification are  encapsulated between the key words <code class="docutils literal notranslate"><span class="pre">ParametersBegin</span></code> and <code class="docutils literal notranslate"><span class="pre">ParametersEnd</span></code>.</p>
<p>Parameters that relate to the flow are passed as comand line arguments.</p>
<p>Parameters have the format &lt;key&gt;,&lt;value&gt;</p>
<p>FABulous defines the following parameters:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ConfigBitMode</span></code>, <code class="docutils literal notranslate"><span class="pre">[frame_based|FlipFlopChain]</span></code></p>
<p>FABulous can write to the configuration bits in a frame-based organisation very similar to what most industry FPGAs do. This supports partial reconfiguration and is (except for tiny fabrics) superior in any sense (configuration speed, resource cost, power consumption) over flip flop scan chain configuration (which is was most other open source FPGA frameworks opted for).</p>
<p>Configuration readback is not supported so far as it was considdered inaffective for embeddd FPGA use cases.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">FrameBitsPerRow</span></code>, <code class="docutils literal notranslate"><span class="pre">unsigned_int</span></code></p>
<p>In frame-based configuration mode, FABulous will build a configuration frame register over the height of the fabric and providing the specified number of data bits per row. This whill generate frame_data wires in the fabric, which correspond to bitlines in a memory organisation.</p>
<p>Note that the specified size corresponds to the width of the parallel configuraton port and 32 bits is the most sensible configuration for most systems.</p>
<p>Currently, we set <code class="docutils literal notranslate"><span class="pre">FrameBitsPerRow</span></code> globally for all rows but we plan to extend this to allow for resurce type specific adjustments in future versions.
For instance, the tiles at the north border of a fabric may only provide some fixed U-turn routing without the need of any configuration bits and we could reflect this by removing all frame_data wires in the top row. This extension may include an automatic adjustment mode.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MaxFramesPerCol</span></code>, <code class="docutils literal notranslate"><span class="pre">unsigned_int</span></code></p>
<p>For the frame-based configuration mode, this will specify the number of configurations frames a tile may use. The total number of configuration bits usable is:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">FrameBitsPerRow</span></code> x <code class="docutils literal notranslate"><span class="pre">MaxFramesPerCol</span></code></p>
</div></blockquote>
<p>Note that we can leave possible configuration bits unused and that no configuration latches will be generated for unused bits.</p>
<p>FABuloud whill generate the specified number of vertical frame_strobe wires in the fabric, which correspond to wordlines in a memory organisation.</p>
<p><code class="docutils literal notranslate"><span class="pre">FrameBitsPerRow</span></code> and <code class="docutils literal notranslate"><span class="pre">MaxFramesPerCol</span></code> should be around the same number to minimize the wiring resources for driving the configuratoin bits into the fabric. In most cases, only <code class="docutils literal notranslate"><span class="pre">MaxFramesPerCol</span></code> will be adjusted to a number that can accomodate the number of configuration bits needed.</p>
<p>Currently, we set <code class="docutils literal notranslate"><span class="pre">MaxFramesPerCol</span></code> globally for all resource types (e.g., LUTs and DSP block columns) but we plan to extend this to allow for resurce type specific adjustments.
This feature may include an automatic adjustment mode.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Package</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code></p>
<p>This option will populate the package declaratio block on VHDL output mode with the string to declare a package.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GenerateDelayInSwitchMatrix</span></code>, <code class="docutils literal notranslate"><span class="pre">unsigned_int</span></code></p>
<p>This option will annotate the specified time in ps to all switch matrix multiplexers. This ignored for synthesis but allows simulating the fabric in the case of configured loops (e.g., ring-oscillators).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">MultiplexerStyle</span></code>, <code class="docutils literal notranslate"><span class="pre">[cutom|TODO]</span></code></p>
<p>FABulous can generate the switch matrix multiplexers in different styles including behavioral RTL, instantiating standard cell primitives and instantiation of full custom multiplexers.</p>
<p>The latter is implemented by replacing a defined n-input multiplexer with a predefined template. For instance, for the Skywater 130 process, we provide a transmission gate-based custom MUX4. In the case of requiring a MUX16, FABulous will synthesize this multiplexer to use 4 + 1 of our custom cells.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>So far, FABulous fabrics are using fully (binary) encoded multiplexers (e.g., a MUX16 requires 4 configuration bits). However, the major vendors Xilinx and Intel use highly optimized SRAM cells where a configuration cell may directly controll a passtransistor (e.g., this is used in Xilinx UltraScale fabrics). For a MUX16, this requires 2 x 4 = 8 configuration bits, but is slightly better in area as omits a decoder.
We plan to extend the FABulous switch matrix compiler accordingly.</p>
</div>
</li>
</ul>
</li>
</ul>
</section>
<section id="fabric-layout">
<span id="id1"></span><h2>Fabric layout<a class="headerlink" href="#fabric-layout" title="Permalink to this headline">Â¶</a></h2>
<p>FABulous models FPGA fabrics as simple CSV files that describe the fabric layout in terms of <a class="reference internal" href="#tiles"><span class="std std-ref">Tiles</span></a>.
A tile is the smallest unit in a fabric and typically hosts primitives like a CLB with LUTs or an I/O block.
Multiple smaller tiles can be combined into <a class="reference internal" href="#supertiles"><span class="std std-ref">Supertiles</span></a>.
The following figure shows the fabric.csv representation of our example fabric as shown in a spreadsheet program.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/Fabric_spreadsheet.png"><img alt="FABulous example fabric in csv representation" src="_images/Fabric_spreadsheet.png" style="width: 60%;" /></a>
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">FabricBegin</span>
</span><span class="n">NULL</span><span class="p">,</span>  <span class="n">N_term</span><span class="p">,</span>   <span class="n">N_term</span><span class="p">,</span>   <span class="n">N_term</span><span class="p">,</span>  <span class="n">N_term</span><span class="p">,</span>  <span class="n">NULL</span>
<span class="n">W_IO</span><span class="p">,</span>  <span class="n">RegFile</span><span class="p">,</span>  <span class="n">DSP_top</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">CPU_IO</span>
<span class="n">W_IO</span><span class="p">,</span>  <span class="n">RegFile</span><span class="p">,</span>  <span class="n">DSP_bot</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">CPU_IO</span>
<span class="n">W_IO</span><span class="p">,</span>  <span class="n">RegFile</span><span class="p">,</span>  <span class="n">DSP_top</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">CPU_IO</span>
<span class="n">W_IO</span><span class="p">,</span>  <span class="n">RegFile</span><span class="p">,</span>  <span class="n">DSP_bot</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">LUT4AB</span><span class="p">,</span>  <span class="n">CPU_IO</span>
<span class="n">NULL</span><span class="p">,</span>  <span class="n">S_term</span><span class="p">,</span>   <span class="n">S_term</span><span class="p">,</span>   <span class="n">S_term</span><span class="p">,</span>  <span class="n">S_term</span><span class="p">,</span>  <span class="n">NULL</span>
<span class="hll"><span class="n">FabricEnd</span>
</span></pre></div>
</div>
<ul>
<li><p>The fabric layout is encapsulated between the key words <code class="docutils literal notranslate"><span class="pre">FabricBegin</span></code> and <code class="docutils literal notranslate"><span class="pre">FabricEnd</span></code>.</p>
<p>The specified tiles are references to tile descriptors (see <a class="reference internal" href="#tiles"><span class="std std-ref">Tiles</span></a>).
The tiles form a coordinate system with the origin in the top-left:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 26%" />
<col style="width: 26%" />
<col style="width: 22%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>X0Y0</p></td>
<td><p>X1Y0</p></td>
<td><p>X2Y0</p></td>
<td><p>â¦</p></td>
</tr>
<tr class="row-even"><td><p>X0Y1</p></td>
<td><p>X1Y1</p></td>
<td><p>X2Y1</p></td>
<td><p>â¦</p></td>
</tr>
<tr class="row-odd"><td><p>â¦</p></td>
<td><p>â¦</p></td>
<td><p>â¦</p></td>
<td><p>â¦</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">NULL</span></code> tiles are used for padding and no code will be generated for these. <code class="docutils literal notranslate"><span class="pre">NULL</span></code> tiles can be used to build non-rectangular shaped fabrics.</p>
</li>
</ul>
</section>
<section id="tiles">
<span id="id2"></span><h2>Tiles<a class="headerlink" href="#tiles" title="Permalink to this headline">Â¶</a></h2>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/tile_CLB_example.png"><img alt="Basic tile illustration" src="_images/tile_CLB_example.png" style="width: 30%;" /></a>
</figure>
<p>A tile is the smallest unit in a fabric and a tile provides</p>
<ul class="simple">
<li><p>A sescription of <a class="reference internal" href="#wires"><span class="std std-ref">Wires</span></a> to adjacent tiles</p></li>
<li><p>A central <a class="reference internal" href="#switch-matrix"><span class="std std-ref">Switch matrix</span></a></p></li>
<li><p>An optional list of <a class="reference internal" href="#primitives"><span class="std std-ref">Primitives</span></a></p></li>
<li><p>A central configuration storage module</p></li>
</ul>
<p>A tile typically hosts primitives like a CLB with LUTs or an I/O block.
Multiple smaller tiles can be combined into <a class="reference internal" href="#supertiles"><span class="std std-ref">Supertiles</span></a> to accomodate complex blocks like DSPs.
Each tile that is refered to in the <a class="reference internal" href="#fabric-layout"><span class="std std-ref">Fabric layout</span></a> requrires to specify the corresponding tile description in the fabric.csv file that has the following format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">TILE</span><span class="p">,</span> <span class="n">LUT4AB</span>      <span class="c1"># define tile name</span>
</span><span class="c1">#direction  source_name  X-offset  Y-offset  destination_name  wires</span>
<span class="n">NORTH</span><span class="p">,</span>      <span class="n">N1BEG</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>        <span class="n">N1END</span><span class="p">,</span>            <span class="mi">4</span>
<span class="n">EAST</span><span class="p">,</span>       <span class="n">E2BEG</span><span class="p">,</span>       <span class="mi">1</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>        <span class="n">N2END</span><span class="p">,</span>            <span class="mi">6</span>
<span class="n">JUMP</span><span class="p">,</span>       <span class="n">J_BEG</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>        <span class="n">J_END</span><span class="p">,</span>            <span class="mi">12</span>
<span class="o">...</span>
<span class="c1">#         RTL code                     optional prefix</span>
<span class="n">BEL</span><span class="p">,</span>      <span class="n">LUT4c_frame_config_OQ</span><span class="o">.</span><span class="n">vhdl</span><span class="p">,</span>  <span class="n">LA_</span>
<span class="n">BEL</span><span class="p">,</span>      <span class="n">LUT4c_frame_config_OQ</span><span class="o">.</span><span class="n">vhdl</span><span class="p">,</span>  <span class="n">LB_</span>
<span class="o">...</span>
<span class="n">MATRIX</span><span class="p">,</span>   <span class="n">LUT4AB_switch_matrix</span><span class="o">.</span><span class="n">vhdl</span>
<span class="hll"><span class="n">EndTILE</span>
</span></pre></div>
</div>
<section id="wires">
<span id="id3"></span><h3>Wires<a class="headerlink" href="#wires" title="Permalink to this headline">Â¶</a></h3>
<p>Wires are defined by 5-tuples:</p>
<p><code class="docutils literal notranslate"><span class="pre">direction</span></code>,  <code class="docutils literal notranslate"><span class="pre">source_name</span></code>,  <code class="docutils literal notranslate"><span class="pre">X-offset</span></code>,  <code class="docutils literal notranslate"><span class="pre">Y-offset</span></code>,  <code class="docutils literal notranslate"><span class="pre">destination_name</span></code>,  <code class="docutils literal notranslate"><span class="pre">wires</span></code></p>
<p>specifying:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">direction</span></code>, <code class="docutils literal notranslate"><span class="pre">[NORTH|EAST|SOUTH|WEST|JUMP]</span></code></p>
<p>The keyword <code class="docutils literal notranslate"><span class="pre">JUMP</span></code> specifies a stop-over at the switch matrix, which is a logical wire that starts and ends at the same switch matrix (i.e. <code class="docutils literal notranslate"><span class="pre">X-offset</span></code> = 0 and <code class="docutils literal notranslate"><span class="pre">Y-offset</span></code> = 0).</p>
<p>Jump wires are useful to model hierarchies, some sharing of multiplexers or tapping into routing paths, as shown in the examples below.</p>
<p>In the VPR and Altera world, tiles separate between a connection switch matrix and the actual local wire switch matrix. The connection switch matrix is nothing else as a bank of multiplexers selecting from the local routing wires a pool of connection wires that can then be further routed to primitive pins (e.g, a LUT input). In FABulous, those connection wires would be modelled with a set of jump wires, which connect then somehow to the primitive input multiplexers.</p>
<p>Older Xilinx architectures have a less hierarchical routing graph and local routing wires between the tiles connect drectly to the input multiplexers of the primitives.</p>
<p>Xilinx Virtex-5 FPGAs provide diagonal routing wires (e.g., a wire routing in north-east direction), a concept abbandoned in consecutive Xilinx FPGA families. FABulous can model diagonal routing by splitting a wire in its components (e.g., a north-east wire can be modeled by cascading a north wire and an east wire).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">source_name</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">destination_name</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code></p>
<p>These are symbolic names for the ports used for the tile top wrapper and the switch matrix connections.
It is recomended to follow a semantic that expresses the direction, routing span (i.e. how many tiles far away the wire is spanning) if it is a <em>begin</em> or <em>end</em> or other port.
For instance, a single wire in NORTH direction should use names like <em>N1Beg</em> to <em>N1End</em> or <em>N1b</em> to <em>N1e</em>.</p>
<p>The destination name refers to two ports: a port on the target tile and an expected port on the destination tile. This reflects that wires route between tiles and that the begin and end ports of a tile connect to different wires.
However, while this works for tiles inside the fabric (like CLBs), the tiles at the border do usually not extend to antennas outside the fabric but instead route wires back into the fabric as shown in the following figure:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/east_terminate.png"><img alt="Basic tile illustration" src="_images/east_terminate.png" style="width: 100%;" /></a>
</figure>
<p>The figure illustrates how horizontal quad wires (that route 4 tiles far) are terminated at the east border of the fabric. The example follows the method used by Xilinx to terminate wires at the border of the chip.
FABulous can implement this scheme, but also any other, including some extra switching at the fabric borders and providing some primitives.</p>
<p>The figure shows that each CLB tile has a pair of input and output ports for the two east and west directions while the east_terminate tile only has an east end port and a west begin port. Moreover, the figure shows the nested routig for long distance wires (see also the wires bullet below). It can be seen that the CLBs route through long distance wires (here quad wires) while the east_terminate tile  has all internal wires connected to the switch matrix. Note that this is only an abstract view and the wires that route through the CLBs may still be buffered inside the CLB tiles. However this is transparent from the user and not included in the architecture graph.</p>
<p>The shown wires in the CLBs (from the last figure) are modeled as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is for the CLBs in the example</span>
    <span class="c1">#direction  source_name  X-offset  Y-offset  destination_name  wires</span>
<span class="n">EAST</span><span class="p">,</span>       <span class="n">E4b</span><span class="p">,</span>         <span class="mi">4</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>        <span class="n">E4e</span><span class="p">,</span>              <span class="n">N</span>    <span class="c1"># N is used for illustration only</span>
<span class="n">WEST</span><span class="p">,</span>       <span class="n">W4b</span><span class="p">,</span>         <span class="o">-</span><span class="mi">4</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>        <span class="n">W4e</span><span class="p">,</span>              <span class="n">N</span>    <span class="c1"># N is used for illustration only</span>
</pre></div>
</div>
<p>To control the different bahavior for tiles that do not extend a wire (as done in the terminate tiles), we use the <code class="docutils literal notranslate"><span class="pre">NULL</span></code> port name for wire begin or end ports that should not be generated on the tile:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># this is for the east_terminate tile in the example</span>
<span class="c1">#direction  source_name  X-offset  Y-offset  destination_name  wires</span>
<span class="n">EAST</span><span class="p">,</span>       <span class="n">NULL</span><span class="p">,</span>        <span class="mi">4</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>        <span class="n">E4e</span><span class="p">,</span>              <span class="n">N</span>    <span class="c1"># N is used for illustration only</span>
<span class="n">WEST</span><span class="p">,</span>       <span class="n">W4b</span><span class="p">,</span>         <span class="o">-</span><span class="mi">4</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>        <span class="n">NULL</span><span class="p">,</span>             <span class="n">N</span>    <span class="c1"># N is used for illustration only</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">NULL</span></code> port entry for the EAST source_name and the WEST destination_name will prevent creating the corresponsing tile port names. Moreover the <code class="docutils literal notranslate"><span class="pre">NULL</span></code> port entries also will tell FABulous to connect <em>all</em> wires or the corresponding entry, including the nested ones, to the switch matrix. This allows the implementation of the shown U-turn routing scheme for termination but also any other more sophisticated termination scheme.</p>
<p>For instance, in the FlexBex project, a FABulous eFPGA was coupled with the Ibex RISC V core for custum instruction set extensions (where the eFPGA fabric operates logically in parallel to the ALU) as shown in the following figure:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/Ibex_eFPGA.png"><img alt="Basic tile illustration" src="_images/Ibex_eFPGA.png" style="width: 90%;" /></a>
</figure>
<p>In this example, the CPU interface is located at the west border of the fabric. The fabric provides three slots, each being two CLB columns wide. The operands are routed into the fabric using double wires (so, each slot receives the operands at exactly the same position, which makes modules relocatable amonth the slots). The results are routed to the CPU using nested hex wires (again resulting in a homogeneous routing scheme that enables module relocation). The CPU has therefore access to the results of each slot and will multiplex results into the register file in case a custom instruction requires to do so. For simplicity, the figure is not showing the west termination tiles, which simply connect the internal routing wires to the top-level fabric wrapper that, in turn, is used to connect to the CPU.
In summery, the example shows how a termination tile can be used to provide more complex interface blocks and all this can be easily modeled and implemented with FABulous.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">destination_name</span></code> is refering to the port name used at the destination tile. FABulous will throw an error if the destination tile does not provide that port name.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">X-offset</span></code>, <code class="docutils literal notranslate"><span class="pre">signed_int</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">Y-offset</span></code>, <code class="docutils literal notranslate"><span class="pre">signed_int</span></code></p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/wire_tile_grid.png"><img alt="Basic tile illustration" src="_images/wire_tile_grid.png" style="width: 40%;" /></a>
</figure>
<p>FABulous models wires strictly in horizontal or vertical direction but never directly in diagonal direction, as this reflects directly the tiled physical implementation of the fabric.
Therefore, in each wire specification, either <code class="docutils literal notranslate"><span class="pre">X-offset</span></code> is <code class="docutils literal notranslate"><span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">Y-offset</span></code> is <code class="docutils literal notranslate"><span class="pre">X-offset</span></code> or both are <code class="docutils literal notranslate"><span class="pre">0</span></code> (in the case of a JUMP wire).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">direction</span></code> field and the sign of the <code class="docutils literal notranslate"><span class="pre">X-offset</span></code> and <code class="docutils literal notranslate"><span class="pre">Y-offset</span></code> values are redundant. FABulous uses internally the absulute <code class="docutils literal notranslate"><span class="pre">X-offset</span></code> and <code class="docutils literal notranslate"><span class="pre">Y-offset</span></code> values and only the <code class="docutils literal notranslate"><span class="pre">direction</span></code> field for specifying the direction of a wire. However, FABulous will throw a warning if there is a missmatch with the sign.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">wires</span></code>, <code class="docutils literal notranslate"><span class="pre">unsigned_int</span></code>
Specifies the number of wires.</p>
<p>FABulous will index the wires of each entry starting from [0].</p>
</li>
</ul>
<p>A metric that is important for FPGA ASIC implementations is the channel <em>cut</em> number, which is denoting the number of wires that must be accomodated between two adjacent tiles. The cut number is an indicator for the congestion to be expected when stitching together the fabric. Let us take the following example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">TILE</span><span class="p">,</span> <span class="n">Example_tile</span>      <span class="c1"># define tile name</span>
</span><span class="c1">#direction  source_name  X-offset  Y-offset  destination_name  wires</span>
<span class="n">EAST</span><span class="p">,</span>       <span class="n">E1Beg</span><span class="p">,</span>       <span class="mi">1</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>        <span class="n">E1End</span><span class="p">,</span>            <span class="mi">6</span>
<span class="n">WEST</span><span class="p">,</span>       <span class="n">W4Beg</span><span class="p">,</span>       <span class="o">-</span><span class="mi">4</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>        <span class="n">W4End</span><span class="p">,</span>            <span class="mi">3</span>
</pre></div>
</div>
<p>The following figure shows the corresponding wiring between the tiles.
Note that a wire with a span greater 1 is usually nested.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/wires_model.png"><img alt="Example of a 6 single East wires and 3 quad west wires" src="_images/wires_model.png" style="width: 40%;" /></a>
</figure>
<p>Each entry in the wire specification contributes with max(abs(<code class="docutils literal notranslate"><span class="pre">X-offset</span></code>),abs(<code class="docutils literal notranslate"><span class="pre">y-offset</span></code>)) x <code class="docutils literal notranslate"><span class="pre">wires</span></code> to the cut number.
In this example, the east single wire (E1Beg) is contributing with 1 x 6 = 6 and the west quad wire (W4Beg) with 4 x 3 = 12 wire segments to he cut.
Therefore, even we have only half the number of quad wires, these contribute double the number of ASIC routing tracks to the cut.
Furthermore, the wires needed to write the configuration into the configuration memory cells are further conributing substantially to the cut (see parameter <code class="docutils literal notranslate"><span class="pre">FrameBitsPerRow</span></code> in section <a class="reference internal" href="#fabric-csv"><span class="std std-ref">Fabric csv description</span></a>).</p>
<p>The switch matrices see only the <code class="docutils literal notranslate"><span class="pre">wires</span></code> anount of wires, regardless of the span. However, the tile-to-tile interfaces include all nested wires concatenated together to a wide vector. FABulous connects the <code class="docutils literal notranslate"><span class="pre">wires</span></code> LSBs to the switch matrix inputs and the switch matrix otputs are conneted to the <code class="docutils literal notranslate"><span class="pre">wires</span></code> MSBs. Inside the tile, the wide vector is shifted by <code class="docutils literal notranslate"><span class="pre">wires</span></code> before routing it to the next tile, as shown in the following figure for an EAST hex-wire example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">TILE</span><span class="p">,</span> <span class="n">CLB</span>
</span><span class="c1">#direction  source_name  X-offset  Y-offset  destination_name  wires</span>
<span class="n">EAST</span><span class="p">,</span>       <span class="n">E1B</span><span class="p">,</span>         <span class="mi">6</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>        <span class="n">E1E</span><span class="p">,</span>              <span class="mi">2</span>
</pre></div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/wire_nesting_indexing.png"><img alt="Wire nesting and wire indexing" src="_images/wire_nesting_indexing.png" style="width: 100%;" /></a>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A typical CLB requires about 100 to 200 wire connections between adjacent tiles (about 400 to 800 wires in total per tile).</p>
<p>The shift register configuration mode needs less wire connections than frame-based configuration at the tiole border but shift register mode intends to have a slightly higher congestion inside the tiles because of the long chain.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because long distance wires contribute heavily to the cut number, it can be beneficial to segment long ditance wires to better balance between the silicon core area and the available metal stack for implementing the routing.</p>
</div>
</section>
<section id="switch-matrix">
<span id="id4"></span><h3>Switch matrix<a class="headerlink" href="#switch-matrix" title="Permalink to this headline">Â¶</a></h3>
<p>FABulous usually implements all routing in a central switch matrix.
The inputs to the switch matrix are the wire end ports of the local wires and JUMP wires and the outputs of the <a class="reference internal" href="#primitives"><span class="std std-ref">Primitives</span></a>.
Hierarchies in an FPGA architecture graph will usually be modelled through JUMP wires (as shown in the <a class="reference internal" href="#tiles"><span class="std std-ref">Tiles</span></a> figure).
However, while it is possible to have multiple switch matrices in a tile, this is not recommended.</p>
<p>Configurable connections are defined in either an adjacency list or an adjacency matrix.</p>
<p><strong>Adjacency list</strong> files follow the naming convention &lt;tile_descriptor&gt;_switch_matrix.list (e.g., LUT4AB_switch_matrix.list).</p>
<p>A switch matrix entry is specified by a line &lt;output_port&gt;,&lt;input_port&gt;.
For convinience, it is possible to specify multiple ports though a list operator [item1|item2|â¦].
For instance, the following line in a list file</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">N</span><span class="o">|</span><span class="n">E</span><span class="o">|</span><span class="n">S</span><span class="o">|</span><span class="n">W</span><span class="p">]</span><span class="mi">2</span><span class="n">BEG</span><span class="p">[</span><span class="mi">0</span><span class="o">|</span><span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="p">],[</span><span class="n">N</span><span class="o">|</span><span class="n">E</span><span class="o">|</span><span class="n">S</span><span class="o">|</span><span class="n">W</span><span class="p">]</span><span class="mi">2</span><span class="n">END</span><span class="p">[</span><span class="mi">0</span><span class="o">|</span><span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># extend double wires in each direction</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N2BEG0</span><span class="p">,</span><span class="n">N2END0</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">E2BEG0</span><span class="p">,</span><span class="n">E2END0</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">S2BEG0</span><span class="p">,</span><span class="n">S2END0</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">W2BEG0</span><span class="p">,</span><span class="n">W2END0</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">N2BEG1</span><span class="p">,</span><span class="n">N2END1</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">E2BEG1</span><span class="p">,</span><span class="n">E2END1</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">S2BEG1</span><span class="p">,</span><span class="n">S2END1</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">W2BEG1</span><span class="p">,</span><span class="n">W2END1</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">N2BEG2</span><span class="p">,</span><span class="n">N2END2</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">E2BEG2</span><span class="p">,</span><span class="n">E2END2</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">S2BEG2</span><span class="p">,</span><span class="n">S2END2</span> <span class="c1"># extend double wires in each direction</span>
<span class="n">W2BEG2</span><span class="p">,</span><span class="n">W2END2</span> <span class="c1"># extend double wires in each direction</span>
</pre></div>
</div>
<p>The example shows how port names can be composed from string segments that can alternatively be provided in list form. The lists will be recursevely unwrapped, which allows it to use multiple list operators together.</p>
<p>An error message is generated if the number of composed port names differs for the number of input_ports and output_ports or if ports are not found.
A warning will be generated if am already specified connection is tried to be set again.</p>
<p>A switch matrix multiplexer is modeled by having multiple connections for the same &lt;output_port&gt;. For example, a MUX4 can be modeled as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N2BEG0</span><span class="p">,</span><span class="n">N2END3</span> <span class="c1"># cascade and twist wire index</span>
<span class="n">N2BEG0</span><span class="p">,</span><span class="n">E2END2</span> <span class="c1"># turn from east to north</span>
<span class="n">N2BEG0</span><span class="p">,</span><span class="n">S2END1</span> <span class="c1"># U-turn</span>
<span class="n">N2BEG0</span><span class="p">,</span><span class="n">LB_O</span>   <span class="c1"># route LUT B output north</span>

<span class="c1"># the same in compact form:</span>
<span class="n">N2BEG</span><span class="p">[</span><span class="mi">0</span><span class="o">|</span><span class="mi">0</span><span class="o">|</span><span class="mi">0</span><span class="o">|</span><span class="mi">0</span><span class="p">],[</span><span class="n">N2END3</span><span class="o">|</span><span class="n">E2END2</span><span class="o">|</span><span class="n">S2END1</span><span class="o">|</span><span class="n">LB_O</span><span class="p">]</span>
</pre></div>
</div>
<p>Adjacency lists are better for specifying and mantaing the connections while an adjaceny matrix is better for monitoring and debug.
FABulous works on adjacency matrices and the tool can translate arbitrarily between both.
<strong>Adjacency matrix</strong> files are csv files and follow the naming convention &lt;tile_descriptor&gt;_switch_matrix.csv (e.g., LUT4AB_switch_matrix.csv).
The following figure shows a list file and the corresponding adjacency matrix:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/adjacency.png"><img alt="Basic tile illustration" src="_images/adjacency.png" style="width: 90%;" /></a>
</figure>
<p>The adjaceny matrix states the tile identifyer name in the top left cell.
The columns denote the input ports to the switch matrix and the rows the output ports.
A <code class="docutils literal notranslate"><span class="pre">1</span></code> in the matrix demotes a configurable connection (i.e. a multiplexer input connection) and each <code class="docutils literal notranslate"><span class="pre">1</span></code> corresponds to a &lt;output_port&gt;,&lt;input_port&gt; tuple defined in the adjacency list.
Therefore, each row is corresponding to one switch matrix multiplexer.</p>
<p>When generating the adjacency matrix, FABulous will annotate for each row and column the number of connections set.
For the rows, this denotes the size of the multiplexers (e.g., MUX4) and by checking the column summery, we can insspect how well the wire usage is balanced.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that we can define the port names <code class="docutils literal notranslate"><span class="pre">VCC</span></code> and <code class="docutils literal notranslate"><span class="pre">GND</span></code> in <a class="reference internal" href="#wires"><span class="std std-ref">Wires</span></a>, which allows it to specify a configurable multiplexer setting to <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code>. For instance, this is useful for BRAM pins where unused ports (e.g., some MSB address bits) have to be tied to <code class="docutils literal notranslate"><span class="pre">0</span></code> without the need of any further LUTs or routing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#direction  source_name  X-offset  Y-offset  destination_name  wires</span>
<span class="n">JUMP</span><span class="p">,</span>       <span class="n">NULL</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>        <span class="n">GND</span><span class="p">,</span>              <span class="mi">1</span>
<span class="n">JUMP</span><span class="p">,</span>       <span class="n">NULL</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>        <span class="n">VCC</span><span class="p">,</span>              <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The multiplexers in the switch matrices are controled by configuration bits only.</p>
<p>The multiplexers in <a class="reference internal" href="#primitives"><span class="std std-ref">Primitives</span></a> can either be controlled by configuration bits (e.g., to select if a LUT output is to be routed to a primitive output pin or through a flop) or by the user logic (e.g., to cascade adjacent LUTs for implementing larger LUTs (like the F7MUX and F8MUX multiplexers in Xilinx FPGAs with LUT6).</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Defining the adjaceny of a switch matrix (and the wires) is a difficult task. Too many connections and wires are expensive to implement and will result in poor density and potentially in poor performance. However, to few connections and wires may not allow to implement the intended user circuits on the fabric in the first place. The latter issue is not easily solvable by leaving primitives unused because that requires, for example, to use more CLBs. That, in turn, requires more wires between the tiles, and will therefore jeopardizing the approach of underutilzing the CLBs.</p>
<p>Another difficulty is setting good switch matrix connections. An architecture graph should have sufficient entropy because of the usual sparsity of the graph. For instance, if we have to route from a LUT to a specific DSP pin, and the first path is not hitting that pin, then using an alternative path should result in possible connections to a different subset of pins. This implies that the architecture graph should not state linear combinations in subgraphs. However, adjacent LUT inputs often share the same signal (e.g., when dascading two LUT6 to form one LUT7, the two LUT6 connect to the same 6 signals). This can be used to share some multiplexing in the switch matrices.</p>
<p>To simplify the definition of fabrics, the provided FABulous reference fabrics had been confirmed to implement non-trivial user circuits like different CPU cores.
The provided switch matrices can be easily reused in new custom tiles (it is standard to have mostly identical switch matrices throughout an FPGA fabric, even if resources (LUTs, BRAMs, DSPs) differ).
Moreover, downstripping the routing fabric is easily possible by removing wires and connections.</p>
</div>
</section>
<section id="primitives">
<span id="id5"></span><h3>Primitives<a class="headerlink" href="#primitives" title="Permalink to this headline">Â¶</a></h3>
<p>Primitives are used to manipulate, store and IO data. Examples for primitives include LUTs, slices (a cluster of LUTs that share a clock and that can be cascaded for arithmetic), flip flops, individual gates or multiplexers or complex blocks like DSPs, ALUs or BRAMs. A tile may have no ptimitves (e.g., the north and south terminate tiles in our example fabric) or as many as needed.</p>
<p>Primitves are added with <code class="docutils literal notranslate"><span class="pre">BEL</span></code> statements (BEL stands for basic element and the phrase is adopted from Xilinx), as shown in the following tile definition fragment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">TILE</span><span class="p">,</span> <span class="n">LUT4AB</span>      <span class="c1"># explained in subsection Tiles</span>
</span><span class="c1">#direction  source_name  X-offset  Y-offset  destination_name  wires</span>
<span class="n">NORTH</span><span class="p">,</span>      <span class="n">N1BEG</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>        <span class="n">N1END</span><span class="p">,</span>            <span class="mi">4</span>
<span class="o">...</span>
<span class="c1"># bel keyword     RTL code         optional prefix</span>
<span class="hll"><span class="n">BEL</span><span class="p">,</span>              <span class="n">LUT4</span><span class="o">.</span><span class="n">vhdl</span><span class="p">,</span>       <span class="n">LA_</span>
</span><span class="hll"><span class="n">BEL</span><span class="p">,</span>              <span class="n">LUT4</span><span class="o">.</span><span class="n">vhdl</span><span class="p">,</span>       <span class="n">LB_</span>
</span><span class="o">...</span>
<span class="n">MATRIX</span><span class="p">,</span>           <span class="n">LUT4AB_switch_matrix</span><span class="o">.</span><span class="n">vhdl</span>
<span class="hll"><span class="n">EndTILE</span>
</span></pre></div>
</div>
<p>FABulous simply adds primitves as RTL code blocks. This is a different philosophy than the usual VPR approach where primitives are generated by models. While the VPR path has advantages to drive an automated design space exploration, the FABulous way is more convinient when modeling an existing fabric. However, this requires some adaptations to the FPGA CAD tools as described in TODO. Complex blocks are usually not infered by VHDL or Verilog constructs but through direct primitive instantiations, which is common for all commercial FPGAs. Nevertheless, Yosys can implement arrays specified in RTL automatically to BRAMs and the Verilog multiply operator directly to our DSP blocks.</p>
<p>The BEL statements in the previous example instantiates a LUT4 which has the following entity:</p>
<div class="highlight-VHDL notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">LUT4</span> <span class="k">is</span>
 <span class="k">Generic</span> <span class="p">(</span> <span class="n">NoConfigBits</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">18</span> <span class="p">);</span>   <span class="c1">-- has to be adjusted manually</span>
 <span class="k">Port</span> <span class="p">(</span>      <span class="c1">-- IMPORTANT: this has to be in a dedicated line</span>
     <span class="n">I0</span>      <span class="o">:</span> <span class="k">in</span>    <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- LUT inputs</span>
     <span class="n">I1</span>      <span class="o">:</span> <span class="k">in</span>    <span class="kt">STD_LOGIC</span><span class="p">;</span>
     <span class="n">I2</span>      <span class="o">:</span> <span class="k">in</span>    <span class="kt">STD_LOGIC</span><span class="p">;</span>
     <span class="n">I3</span>      <span class="o">:</span> <span class="k">in</span>    <span class="kt">STD_LOGIC</span><span class="p">;</span>
     <span class="n">O</span>       <span class="o">:</span> <span class="k">out</span>   <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- LUT output (combinatorial or FF)</span>
     <span class="n">Ci</span>      <span class="o">:</span> <span class="k">in</span>    <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- carry chain input</span>
     <span class="n">Co</span>      <span class="o">:</span> <span class="k">out</span>   <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- carry chain output</span>
     <span class="n">UserCLK</span> <span class="o">:</span> <span class="k">in</span>    <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- EXTERNAL -- SHARED_PORT</span>
     <span class="c1">-- the # EXTERNAL keyword will send this sisgnal all the way to top and</span>
     <span class="c1">-- #SHARED allows multiple BELs using same port (exports 1 clock to top)</span>
     <span class="n">ConfigBits</span> <span class="o">:</span> <span class="k">in</span>          <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span> <span class="n">NoConfigBits</span> <span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span> <span class="p">)</span>
     <span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span> <span class="nc">LUT4</span><span class="p">;</span>
</pre></div>
</div>
<p>FABulous defines the following coding rules for BELs:</p>
<ul>
<li><p>Each primitive has to specify the number of configuration bits used in a generic/parameter called <code class="docutils literal notranslate"><span class="pre">NoConfigBits</span></code>. This also holds if no configuration bits are used (NoConfigBits := 0).</p></li>
<li><p>The port declarations have to be formated to provide one declaration per line.</p></li>
<li><p>We use directives (provided as comments) to control the code generation semantics. The suported directives include:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">EXTERNAL</span></code>: ports flagged with this directive are not connected to the switch matrix but are exported through the tile entitiy to the top-level fabric wrapper. The corresponding port will be exported with a tile prefix and, if provided in the BEL statement, the instance prefix. The following two blocks provide an OutBlock tile with two BEL statements and the corresponding Out_PAD module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">TILE</span><span class="p">,</span> <span class="n">OutBlock</span>      <span class="c1"># explained in subsection Tiles</span>
</span><span class="o">...</span>
<span class="c1"># bel keyword     RTL code         optional prefix</span>
<span class="hll"><span class="n">BEL</span><span class="p">,</span>              <span class="n">tristate_pin</span><span class="o">.</span><span class="n">vhdl</span><span class="p">,</span>       <span class="n">A_</span>
</span><span class="hll"><span class="n">BEL</span><span class="p">,</span>              <span class="n">tristate_pin</span><span class="o">.</span><span class="n">vhdl</span><span class="p">,</span>       <span class="n">B_</span>
</span></pre></div>
</div>
<div class="highlight-VHDL notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">Out_Pad</span> <span class="k">is</span>
  <span class="k">Generic</span> <span class="p">(</span> <span class="n">NoConfigBits</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">);</span> <span class="c1">-- has to be adjusted manually</span>
  <span class="k">Port</span> <span class="p">(</span>      <span class="c1">-- IMPORTANT: this has to be in a dedicated line</span>
    <span class="n">I</span>     <span class="o">:</span> <span class="k">in</span>    <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- LUT inputs</span>
    <span class="n">O_pin</span> <span class="o">:</span> <span class="k">out</span>   <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- EXTERNAL</span>
    <span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span> <span class="nc">Out_Pad</span><span class="p">;</span>
</pre></div>
</div>
<p>In this example, the O_pin is flagged <code class="docutils literal notranslate"><span class="pre">EXTERNAL</span></code> and the port will therefore appear in the top fabric wrapper as:</p>
<div class="highlight-VHDL notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">eFPGA</span> <span class="k">is</span>
  <span class="k">Generic</span> <span class="p">(</span>
    <span class="n">MaxFramesPerCol</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">20</span><span class="p">;</span>
    <span class="n">FrameBitsPerRow</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">32</span><span class="p">;</span>
    <span class="n">NoConfigBits</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">);</span>
  <span class="k">Port</span> <span class="p">(</span>
    <span class="c1">-- for the first exported port:</span>
            <span class="c1">-- the tile prefix is &quot;Tile_X0Y1&quot;,</span>
            <span class="c1">-- the BEL instance prefix is &quot;_A&quot; and</span>
            <span class="c1">-- the pin name is &quot;O_pin&quot;</span>
    <span class="n">Tile_X0Y1_A_O_pin</span>  <span class="o">:</span>  <span class="k">out</span> <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- EXTERNAL</span>
    <span class="n">Tile_X0Y1_B_O_pin</span>  <span class="o">:</span>  <span class="k">out</span> <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- EXTERNAL</span>
    <span class="n">Tile_X0Y2_A_O_pin</span>  <span class="o">:</span>  <span class="k">out</span> <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- EXTERNAL</span>
    <span class="n">Tile_X0Y2_B_O_pin</span>  <span class="o">:</span>  <span class="k">out</span> <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- EXTERNAL</span>
            <span class="p">...</span>
    <span class="p">);</span>
<span class="k">end</span> <span class="k">entity</span> <span class="nc">Out_Pad</span><span class="p">;</span>
</pre></div>
</div>
<p>TODO</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">SHARED_PORT</span></code>: this directive can only be used together optionally with <code class="docutils literal notranslate"><span class="pre">EXTERNAL</span></code>. Is a port is set <code class="docutils literal notranslate"><span class="pre">EXTERNAL</span></code> but not <code class="docutils literal notranslate"><span class="pre">SHARED_PORT</span></code>, then , a TODO ( shared  ports flagged with this directive are not connected to the switch matrix but are exported through the tile entitiy to the top-level fabric wrapper.</p></li>
</ul>
</li>
</ul>
</section>
<section id="bitstream-remapping">
<span id="bitstream"></span><h3>Bitstream remapping<a class="headerlink" href="#bitstream-remapping" title="Permalink to this headline">Â¶</a></h3>
<p>FABulous will take care about implementing the configuration logic and bitstream encoding and the mapping of this into configuration bitstreams. This can be done automatically.
However, users can influence the mapping of configuration bits into the bitstream. We use this in TODO for optimizing the bitstream layout. Moreover, for our first chip, we used remapping to create a human readable bitstream which is more convininet to be modified in a hex editor, as dsscribed later in this subsetion).</p>
<p>In the code example for a LUT, it was shown that the configuration bits are exported into the LUT interface:</p>
<div class="highlight-VHDL notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nc">LUT4</span> <span class="k">is</span>
 <span class="k">Generic</span> <span class="p">(</span> <span class="n">NoConfigBits</span> <span class="o">:</span> <span class="kt">integer</span> <span class="o">:=</span> <span class="mi">18</span> <span class="p">);</span>   <span class="c1">-- has to be adjusted manually</span>
 <span class="k">Port</span> <span class="p">(</span>      <span class="c1">-- IMPORTANT: this has to be in a dedicated line</span>
 <span class="p">...</span>
<span class="hll"> <span class="n">ConfigBits</span> <span class="o">:</span> <span class="k">in</span>      <span class="kt">STD_LOGIC_VECTOR</span><span class="p">(</span> <span class="n">NoConfigBits</span> <span class="o">-</span><span class="mi">1</span> <span class="k">downto</span> <span class="mi">0</span> <span class="p">)</span>  <span class="c1">-- These are the configuration bits</span>
</span></pre></div>
</div>
<p>Exporting configuration bits is a requirement for any primitive or switch matrix that uses configuration bits. The tile configuration bitstream is formed by concatenating first the primitive configuration bits (if primitives are available and use configuration bits) and then the switch matrix configuration bits (again, only if the switch matrix uses configuration bits) into one long tile configuration word.
This is done in the order that the primitives are declared by <code class="docutils literal notranslate"><span class="pre">BEL</span></code> entries in the tile definition. Configuration bitstream vectors are defined in <em>downto</em> direction and the first BEL primitive configuration bits will be placed at the LSB side of the tile bitstream and the configuration switch matrix at the MSB side.</p>
<p>In the case of using the <strong>shift-register configuration mode</strong>, this would form the tile configuration chain. FABulous is only supporting one long bit-serial configuration chain. While configuration speed could bossibly be boosted by using multiple parralel (and correspondingly shorter) chains, we have not added further optimizations, because shift register configuration is inferior to frame-based configuration mode.</p>
<p>For <strong>frame-based configuration mode</strong>, FABulous will pack those configuration bits into frames. By default, FABulous will start with frame 0 and pack the first <code class="docutils literal notranslate"><span class="pre">FrameBitsPerRow</span></code> bits from the tile configuration bitstream starting with the MSBs of the tile bitstream frame-by-frame until all configuration bits are packed. This may leave some of the <code class="docutils literal notranslate"><span class="pre">FrameBitsPerRow</span></code> x <code class="docutils literal notranslate"><span class="pre">MaxFramesPerCol</span></code> possible  configuration bits unused.</p>
<p>FABulous is recording the bitstream mapping file (in CSV format) that follows the naming convention  &lt;tile_descriptor&gt;_ConfigMem.init.csv (e.g., LUT4AB_ConfigMem.init.csv). The file has <code class="docutils literal notranslate"><span class="pre">MaxFramesPerCol</span></code> lines (one per configuration frame, which includes empty frames). A line has the format:</p>
<blockquote>
<div><p>&lt;frame_name&gt;, &lt;frame_index&gt;, &lt;bits_used&gt;, &lt;used_bits_mask&gt;, &lt;ConfigBits_ranges&gt;</p>
</div></blockquote>
<p>Where the fields mean:</p>
<ul>
<li><p>&lt;frame_name&gt; is a symbolic name for a frame which is not further used internally by FABulous.</p></li>
<li><p>&lt;frame_index&gt; is indexed 0 to <code class="docutils literal notranslate"><span class="pre">MaxFramesPerCol</span></code> -1.</p></li>
<li><p>&lt;bits_used&gt; denotes the number of bits that are used in this frame and must be in the range 0 to <code class="docutils literal notranslate"><span class="pre">FrameBitsPerRow</span></code>.</p></li>
<li><p>&lt;used_bits_mask&gt; denotes which bits in a frame will be used. The bitmask is defined MSBs downto LSBs and a <code class="docutils literal notranslate"><span class="pre">1</span></code> denotes a used configuration bit and a <code class="docutils literal notranslate"><span class="pre">0</span></code> denotes a gap bit that will not be used. Note that FABulous will not generate configuration latch for thos gap bits). Again, in frame-based reconfiguration, not all possible <code class="docutils literal notranslate"><span class="pre">FrameBitsPerRow</span></code> x <code class="docutils literal notranslate"><span class="pre">MaxFramesPerCol</span></code> bits will be usually be used and the bitmask specifies the used and unused bits. The number of <code class="docutils literal notranslate"><span class="pre">1</span></code> entries per frame is redundant to &lt;bits_used&gt;. FABulous will count the <code class="docutils literal notranslate"><span class="pre">1</span></code> entries and use that value while &lt;bits_used&gt; is used for checking only.</p></li>
<li><p>&lt;ConfigBits_ranges&gt; denotes a comma-separated list of configuration bits (given by their index) from the tile bitstream. The field can be individual bits or ranges of tile bitstream bits in the form &lt;left_index&gt;:&lt;right_index&gt;. The number of specified bits has to match the number of used configuraton bits as specified by the mask and the mapping is performed in the order the configuratoin bits are listed, as illustrated in the following figure:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/bitstream_mask_mapping.png"><img alt="bitstream_mask_mapping" src="_images/bitstream_mask_mapping.png" style="width: 60%;" /></a>
</figure>
</li>
</ul>
<p>The following exaple is the FABulous-generated mapping file of the CLB implemented for our first FABulous TSMC chip.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#frame_name, frame_index, bits_used, used_bits_mask,                          ConfigBits_ranges</span>
<span class="n">frame0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>           <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">537</span><span class="p">:</span><span class="mi">506</span>
<span class="n">frame1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">,</span>           <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">505</span><span class="p">:</span><span class="mi">474</span>
<span class="n">frame2</span><span class="p">,</span>      <span class="mi">2</span><span class="p">,</span>           <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">473</span><span class="p">:</span><span class="mi">442</span>
<span class="n">frame3</span><span class="p">,</span>      <span class="mi">3</span><span class="p">,</span>           <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">441</span><span class="p">:</span><span class="mi">410</span>
<span class="n">frame4</span><span class="p">,</span>      <span class="mi">4</span><span class="p">,</span>           <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">409</span><span class="p">:</span><span class="mi">378</span>
<span class="n">frame5</span><span class="p">,</span>      <span class="mi">5</span><span class="p">,</span>           <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">377</span><span class="p">:</span><span class="mi">346</span>
<span class="n">frame6</span><span class="p">,</span>      <span class="mi">6</span><span class="p">,</span>           <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">345</span><span class="p">:</span><span class="mi">314</span>
<span class="n">frame7</span><span class="p">,</span>      <span class="mi">7</span><span class="p">,</span>           <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">313</span><span class="p">:</span><span class="mi">282</span>
<span class="n">frame8</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>           <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">281</span><span class="p">:</span><span class="mi">250</span>
<span class="n">frame9</span><span class="p">,</span>      <span class="mi">9</span><span class="p">,</span>           <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">249</span><span class="p">:</span><span class="mi">218</span>
<span class="n">frame10</span><span class="p">,</span>     <span class="mi">10</span><span class="p">,</span>          <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">217</span><span class="p">:</span><span class="mi">186</span>
<span class="n">frame11</span><span class="p">,</span>     <span class="mi">11</span><span class="p">,</span>          <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">185</span><span class="p">:</span><span class="mi">154</span>
<span class="n">frame12</span><span class="p">,</span>     <span class="mi">12</span><span class="p">,</span>          <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">153</span><span class="p">:</span><span class="mi">122</span>
<span class="n">frame13</span><span class="p">,</span>     <span class="mi">13</span><span class="p">,</span>          <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">121</span><span class="p">:</span><span class="mi">90</span>
<span class="n">frame14</span><span class="p">,</span>     <span class="mi">14</span><span class="p">,</span>          <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">89</span><span class="p">:</span><span class="mi">58</span>
<span class="n">frame15</span><span class="p">,</span>     <span class="mi">15</span><span class="p">,</span>          <span class="mi">32</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span> <span class="mi">57</span><span class="p">:</span><span class="mi">26</span>
<span class="n">frame16</span><span class="p">,</span>     <span class="mi">16</span><span class="p">,</span>          <span class="mi">26</span><span class="p">,</span>        <span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1100_0000</span><span class="p">,</span> <span class="mi">25</span><span class="p">:</span><span class="mi">0</span>
<span class="n">frame17</span><span class="p">,</span>     <span class="mi">17</span><span class="p">,</span>          <span class="mi">0</span><span class="p">,</span>         <span class="mo">0000</span><span class="n">_0000_0000_0000_0000_0000_0000_0000</span><span class="p">,</span>
<span class="n">frame18</span><span class="p">,</span>     <span class="mi">18</span><span class="p">,</span>          <span class="mi">0</span><span class="p">,</span>         <span class="mo">0000</span><span class="n">_0000_0000_0000_0000_0000_0000_0000</span><span class="p">,</span>
<span class="n">frame19</span><span class="p">,</span>     <span class="mi">19</span><span class="p">,</span>          <span class="mi">0</span><span class="p">,</span>         <span class="mo">0000</span><span class="n">_0000_0000_0000_0000_0000_0000_0000</span><span class="p">,</span>
</pre></div>
</div>
<p>Users are not required to modify the &lt;tile_descriptor&gt;_ConfigMem.init.csv file. However, if FABulous finds a file called &lt;tile_descriptor&gt;_ConfigMem.csv (without the init), it will use the bitstream mapping provided in that. The followiwng example shows the basic idea that was used to provide a human readable bitstream encoding. It is not intended to understand the example in detail. Tha basic idea is to align configuration LUT function tables, settings and the switch matrix multiplexer encoding to be nibble aligned such that they are easy to find in a hex editor. For instance, in the example below, the first 8 frames are mostly encoding the LUTs where the 16 MSBs are the LUT tables and the next two nibles are encoding a flop and carry-chain mode:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#frame_name, frame_index, bits_used_in_frame, used_bits_mask, ConfigBits_ranges</span>
<span class="n">frame0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1111</span><span class="n">_1111_1111_1111_0001_0001_0001_0001</span><span class="p">,</span><span class="mi">15</span><span class="p">:</span><span class="mo">00</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">144</span><span class="p">,</span><span class="mi">145</span>
<span class="n">frame1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1111</span><span class="n">_1111_1111_1111_0001_0001_0000_0000</span><span class="p">,</span><span class="mi">33</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">35</span>
<span class="n">frame2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1111</span><span class="n">_1111_1111_1111_0001_0001_0011_0011</span><span class="p">,</span><span class="mi">51</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span><span class="mi">52</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">515</span><span class="p">:</span><span class="mi">514</span><span class="p">,</span><span class="mi">517</span><span class="p">:</span><span class="mi">516</span><span class="p">,</span><span class="c1">#,J_l_CD_BEG0,J_l_CD_BEG1</span>
<span class="n">frame3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1111</span><span class="n">_1111_1111_1111_0001_0001_0011_0011</span><span class="p">,</span><span class="mi">69</span><span class="p">:</span><span class="mi">54</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">71</span><span class="p">,</span><span class="mi">519</span><span class="p">:</span><span class="mi">518</span><span class="p">,</span><span class="mi">521</span><span class="p">:</span><span class="mi">520</span><span class="p">,</span><span class="c1">#,J_l_CD_BEG2,J_l_CD_BEG3</span>
<span class="n">frame4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1111</span><span class="n">_1111_1111_1111_0001_0001_0011_0011</span><span class="p">,</span><span class="mi">87</span><span class="p">:</span><span class="mi">72</span><span class="p">,</span><span class="mi">88</span><span class="p">,</span><span class="mi">89</span><span class="p">,</span><span class="mi">523</span><span class="p">:</span><span class="mi">522</span><span class="p">,</span><span class="mi">525</span><span class="p">:</span><span class="mi">524</span><span class="p">,</span><span class="c1">#,J_l_EF_BEG0,J_l_EF_BEG1</span>
<span class="n">frame5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1111</span><span class="n">_1111_1111_1111_0001_0001_0011_0011</span><span class="p">,</span><span class="mi">105</span><span class="p">:</span><span class="mi">90</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="mi">527</span><span class="p">:</span><span class="mi">526</span><span class="p">,</span><span class="mi">529</span><span class="p">:</span><span class="mi">528</span><span class="p">,</span><span class="c1">#,J_l_EF_BEG2,J_l_EF_BEG3</span>
<span class="n">frame6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1111</span><span class="n">_1111_1111_1111_0001_0001_0011_0011</span><span class="p">,</span><span class="mi">123</span><span class="p">:</span><span class="mi">108</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">125</span><span class="p">,</span><span class="mi">531</span><span class="p">:</span><span class="mi">530</span><span class="p">,</span><span class="mi">533</span><span class="p">:</span><span class="mi">532</span><span class="p">,</span><span class="c1">#,J_l_GH_BEG0,J_l_GH_BEG1</span>
<span class="n">frame7</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1111</span><span class="n">_1111_1111_1111_0001_0001_0011_0011</span><span class="p">,</span><span class="mi">141</span><span class="p">:</span><span class="mi">126</span><span class="p">,</span><span class="mi">142</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">535</span><span class="p">:</span><span class="mi">534</span><span class="p">,</span><span class="mi">537</span><span class="p">:</span><span class="mi">536</span><span class="p">,</span><span class="c1">#,J_l_GH_BEG2,J_l_GH_BEG3</span>
<span class="c1">#,E6BEG0   ,E6BEG1   ,W6BEG0   ,W6BEG1   ,JN2BEG0  ,JN2BEG1  ,JN2BEG2  ,JN2BEG3</span>
<span class="n">frame8</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span><span class="mi">173</span><span class="p">:</span><span class="mi">170</span><span class="p">,</span><span class="mi">177</span><span class="p">:</span><span class="mi">174</span><span class="p">,</span><span class="mi">205</span><span class="p">:</span><span class="mi">202</span><span class="p">,</span><span class="mi">209</span><span class="p">:</span><span class="mi">206</span><span class="p">,</span><span class="mi">381</span><span class="p">:</span><span class="mi">378</span><span class="p">,</span><span class="mi">385</span><span class="p">:</span><span class="mi">382</span><span class="p">,</span><span class="mi">389</span><span class="p">:</span><span class="mi">386</span><span class="p">,</span><span class="mi">393</span><span class="p">:</span><span class="mi">390</span>
<span class="c1">#,JN2BEG4  ,JN2BEG5  ,JN2BEG6  ,JN2BEG7  ,JE2BEG0  ,JE2BEG1  ,JE2BEG2  ,JE2BEG3</span>
<span class="n">frame9</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">1111</span><span class="n">_1111_1111_1111_1111_1111_1111_1111</span><span class="p">,</span><span class="mi">397</span><span class="p">:</span><span class="mi">394</span><span class="p">,</span><span class="mi">401</span><span class="p">:</span><span class="mi">398</span><span class="p">,</span><span class="mi">405</span><span class="p">:</span><span class="mi">402</span><span class="p">,</span><span class="mi">409</span><span class="p">:</span><span class="mi">406</span><span class="p">,</span><span class="mi">413</span><span class="p">:</span><span class="mi">410</span><span class="p">,</span><span class="mi">417</span><span class="p">:</span><span class="mi">414</span><span class="p">,</span><span class="mi">421</span><span class="p">:</span><span class="mi">418</span><span class="p">,</span><span class="mi">425</span><span class="p">:</span><span class="mi">422</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The more important use case of bitsteam remapping is to optimize the physial implementation of the configuration tiles. FABulous includes a correspondingg optimizer that generates the bitsteam remapping files automatically. The process is described in detail in TODO FPGA_2022_paper.</p>
</section>
</section>
<section id="supertiles">
<span id="id6"></span><h2>Supertiles<a class="headerlink" href="#supertiles" title="Permalink to this headline">Â¶</a></h2>
<p>Supertiles are grouping together multiple basic <a class="reference internal" href="#tiles"><span class="std std-ref">Tiles</span></a>. Basic tiles are the smallest tile exposed to users providing a switch matrix, wires to the surrounding, and usually one or more primitives (like in a CLB tile).</p>
<p>Supertiles are needed for blocks that require more logic and/or more wires to the routing fabric (e.g., as needed for DSP blocks). Therefore, supertiles will normally provide as many switch matrices as they integrate basic tiles.
However, larger supertiles (e.g., hosting a CPU or similar) may only provide switch matrices in basic tiles located at the border of such a supertile
In any case: supertiles must provide wire interfaces that match the surrounding when stitching them into a fabric.</p>
<section id="modeling">
<h3>Modeling<a class="headerlink" href="#modeling" title="Permalink to this headline">Â¶</a></h3>
<p>Supertiles are modeled from elementary tiles in a spreadsheet/csv file similar to how we model the whole FPGA fabric. Shapes can be defined arbitrary and NULL tiles can be used to skip fields. Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">SuperTILE</span><span class="p">,</span> <span class="n">my_Z</span>      <span class="c1"># define supertile name</span>
</span><span class="n">myZ_00</span><span class="p">,</span>  <span class="n">NULL</span>
<span class="n">myZ_01</span><span class="p">,</span>  <span class="n">myZ_11</span>
<span class="n">NULL</span><span class="p">,</span>    <span class="n">myZ_12</span>
<span class="hll"><span class="n">EndSuperTILE</span>         <span class="c1"># this is case insensitive</span>
</span>
<span class="hll"><span class="n">SuperTILE</span><span class="p">,</span> <span class="n">my_I</span>      <span class="c1"># define supertile name</span>
</span><span class="n">my_top</span>
<span class="n">my_mid</span>
<span class="n">my_bot</span><span class="p">,</span>
<span class="hll"><span class="n">EndSuperTILE</span>
</span>
<span class="hll"><span class="n">SuperTILE</span><span class="p">,</span> <span class="n">my_U</span>      <span class="c1"># define supertile name</span>
</span><span class="n">myU_00</span><span class="p">,</span>  <span class="n">NULL</span><span class="p">,</span>    <span class="n">myU_20</span>
<span class="n">myU_01</span><span class="p">,</span>  <span class="n">NULL</span><span class="p">,</span>    <span class="n">myU_21</span>
<span class="n">myU_02</span><span class="p">,</span>  <span class="n">myU_12</span><span class="p">,</span>  <span class="n">myU_22</span>
<span class="hll"><span class="n">EndSuperTILE</span>
</span></pre></div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/SuperTILE_examples.png"><img alt="SuperTILE examples" src="_images/SuperTILE_examples.png" style="width: 80%;" /></a>
</figure>
<p>Supertiles will be instantiated in the fabric (VHDL or Verilog) file, and supertiles themselves instantiate basic tiles (e.g., the ones shown in the figure). Therefore, supertiles define wires and switch matrices through their instantiated basic tiles.</p>
<p>Supertiles have an <strong>anchor tile</strong>, which is used to specify its position in the fabric. The anchor tile is determined by a row-by-row scan over the basic tiles and it will be the first non-NULL tile found. All other basic tiles will be placed relatively to the anchor tile. The anchor tiles in the figure aabove had been marked using a bolt font. So far, anchor tiles are only used internally in FABulous but it is planned to allow placing supertiles through their anchor tiles in the fabri layour, rather than through their basic tiles.</p>
<p>If a basic tile has a <strong>border to the outside world</strong> (i.e. the surrounding fabric), the interface to that border is exported to the supertile interface (i.e. the Entity in VHDL). Those borders are marked blue in the figure above. Internal edges are connected inside the supertile wrapper according to the entire tile specification.</p>
<p>A basic tile instantiated in a supertile may not implement interfaces to all NORTH, EAST, SOUTH, WEST directions. For instance, a supertile may include basic terminate tiles if the supertile is supposed to be placed at the border of the fabric.</p>
<p>Tile ports that are declared <code class="docutils literal notranslate"><span class="pre">EXTERNAL</span></code> in the basic tiles will be exported all the way to the top-level the same way this is performed for <a class="reference internal" href="#tiles"><span class="std std-ref">Tiles</span></a></p>
<div class="highlight-VHDL notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">VHDL</span> <span class="n">example</span><span class="o">:</span>
</span>         <span class="n">RES0_O0</span>    <span class="o">:</span> <span class="k">out</span>   <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- EXTERNAL   port will be exported to top-level wrapper</span>
         <span class="n">RES0_O1</span>    <span class="o">:</span> <span class="k">out</span>   <span class="kt">STD_LOGIC</span><span class="p">;</span> <span class="c1">-- EXTERNAL   port will be exported to top-level wrapper</span>
<span class="n">Verilog</span> <span class="n">example</span><span class="o">:</span>
</pre></div>
</div>
</section>
<section id="supertile-functionality">
<h3>Supertile Functionality<a class="headerlink" href="#supertile-functionality" title="Permalink to this headline">Â¶</a></h3>
<p>With the instantiation of multiple basic tiles, we define mostly the part related to the routing fabric. The actual functionality of a tile can be either concentrated in one basic tile or inside the supertile wrapper or as a combination of both. The following figure shows this for a simple DSP block example:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/SuperTILE_functionality.png"><img alt="Supertile Functionality through basic tiles of a dedicated module" src="_images/SuperTILE_functionality.png" style="width: 90%;" /></a>
</figure>
<p>The left example is concentrating the DSP functionality in the bottom tile and is modeled as shown in the next code block.
(Note the two extra NORTH and SOUTH wires that provide the connections between the DSP BEL (located bot) and the top basic tile).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">TILE</span><span class="p">,</span>       <span class="n">DSP_top</span>
</span><span class="c1">#direction  source   X-offset  Y-offset destination wires</span>
<span class="n">NORTH</span><span class="p">,</span>      <span class="n">N1BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>       <span class="n">N1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="c1"># connect prmitive outputs to routing fabric</span>
<span class="hll"><span class="n">NORTH</span><span class="p">,</span>      <span class="n">NULL</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>       <span class="n">bot2top</span><span class="p">,</span>    <span class="mi">10</span> <span class="c1"># no route to north</span>
</span><span class="n">EAST</span><span class="p">,</span>       <span class="n">E1BEG</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">E1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">SOUTH</span><span class="p">,</span>      <span class="n">S1BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="n">S1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="c1"># send data from routing fabric to primitive</span>
<span class="hll"><span class="n">SOUTH</span><span class="p">,</span>      <span class="n">top2bot</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="n">NULL</span><span class="p">,</span>       <span class="mi">18</span> <span class="c1"># no route from north</span>
</span><span class="n">WEST</span><span class="p">,</span>       <span class="n">W1BEG</span><span class="p">,</span>   <span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>       <span class="n">W1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">JUMP</span><span class="p">,</span>       <span class="n">J_BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">J_END</span><span class="p">,</span>      <span class="mi">8</span>
<span class="n">MATRIX</span><span class="p">,</span>     <span class="n">DSP_top_switch_matrix</span><span class="o">.</span><span class="n">vhdl</span>
<span class="hll"><span class="n">EndTILE</span>
</span>
<span class="hll"><span class="n">TILE</span><span class="p">,</span>       <span class="n">DSP_bot</span>
</span><span class="c1">#direction  source   X-offset  Y-offset destination wires</span>
<span class="n">NORTH</span><span class="p">,</span>      <span class="n">N1BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>       <span class="n">N1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="c1"># connect prmitive outputs to routing fabric</span>
<span class="hll"><span class="n">NORTH</span><span class="p">,</span>      <span class="n">bot2top</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>       <span class="n">NULL</span><span class="p">,</span>       <span class="mi">10</span> <span class="c1"># no route from south</span>
</span><span class="n">EAST</span><span class="p">,</span>       <span class="n">E1BEG</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">E1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">SOUTH</span><span class="p">,</span>      <span class="n">S1BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="n">S1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="c1"># send data from routing fabric to primitive</span>
<span class="hll"><span class="n">SOUTH</span><span class="p">,</span>      <span class="n">NULL</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="n">top2bot</span><span class="p">,</span>    <span class="mi">18</span> <span class="c1"># no route to south</span>
</span><span class="n">WEST</span><span class="p">,</span>       <span class="n">W1BEG</span><span class="p">,</span>   <span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>       <span class="n">W1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">JUMP</span><span class="p">,</span>       <span class="n">J_BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">J_END</span><span class="p">,</span>      <span class="mi">8</span>
<span class="n">BEL</span><span class="p">,</span>        <span class="n">MULADD</span><span class="o">.</span><span class="n">vhdl</span>                 <span class="c1"># this is the actual functionality</span>
<span class="n">MATRIX</span><span class="p">,</span>     <span class="n">DSP_bot_switch_matrix</span><span class="o">.</span><span class="n">vhdl</span>
<span class="hll"><span class="n">EndTILE</span>
</span>
<span class="hll"><span class="n">SuperTILE</span>   <span class="n">DSP</span>  <span class="c1"># declace supertile  (Functionality concentrated in DSP_bot)</span>
</span><span class="n">DSP_top</span>
<span class="n">DSP_bot</span>
<span class="hll"><span class="n">EndTILE</span>
</span></pre></div>
</div>
<p>The right example is providing the tile functionality in the supertile wrapper and is modeled as shown in the next code block.
(Note the two wire entries with the LOCAL attribute in each basic tile to define that these wires are useable in the supertile wrapper. Furthermore configuration bits for the DSP primitive will be provided through a ConfigBits BEL. This allows it to distribute the number of configuration bits among the basic tiles as needed. Note that configuration bits are organized at basic tile level.)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">TILE</span><span class="p">,</span>       <span class="n">DSP_top</span>
</span><span class="c1">#direction  source   X-offset  Y-offset destination wires</span>
<span class="n">NORTH</span><span class="p">,</span>      <span class="n">N1BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>       <span class="n">N1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">EAST</span><span class="p">,</span>       <span class="n">E1BEG</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">E1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">SOUTH</span><span class="p">,</span>      <span class="n">S1BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="n">S1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">WEST</span><span class="p">,</span>       <span class="n">W1BEG</span><span class="p">,</span>   <span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>       <span class="n">W1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">JUMP</span><span class="p">,</span>       <span class="n">J_BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">J_END</span><span class="p">,</span>      <span class="mi">8</span>
<span class="hll"><span class="n">LOCAL</span><span class="p">,</span>      <span class="n">NULL</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">DSP2top</span><span class="p">,</span>    <span class="mi">10</span>
</span><span class="hll"><span class="n">LOCAL</span><span class="p">,</span>      <span class="n">top2DSP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">NULL</span><span class="p">,</span>       <span class="mi">18</span>
</span><span class="n">BEL</span><span class="p">,</span>        <span class="n">ConfigBits</span><span class="o">.</span><span class="n">vhdl</span>
<span class="n">MATRIX</span><span class="p">,</span>     <span class="n">DSP_top_switch_matrix</span><span class="o">.</span><span class="n">vhdl</span>
<span class="hll"><span class="n">EndTILE</span>
</span>
<span class="hll"><span class="n">TILE</span><span class="p">,</span>       <span class="n">DSP_bot</span>
</span><span class="c1">#direction  source   X-offset  Y-offset destination wires</span>
<span class="n">NORTH</span><span class="p">,</span>      <span class="n">N1BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>       <span class="n">N1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">EAST</span><span class="p">,</span>       <span class="n">E1BEG</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">E1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">SOUTH</span><span class="p">,</span>      <span class="n">S1BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>      <span class="n">S1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">WEST</span><span class="p">,</span>       <span class="n">W1BEG</span><span class="p">,</span>   <span class="o">-</span><span class="mi">1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>       <span class="n">W1END</span><span class="p">,</span>      <span class="mi">4</span>
<span class="n">JUMP</span><span class="p">,</span>       <span class="n">J_BEG</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">J_END</span><span class="p">,</span>      <span class="mi">8</span>
<span class="hll"><span class="n">LOCAL</span><span class="p">,</span>      <span class="n">NULL</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">DSP2bot</span><span class="p">,</span>    <span class="mi">10</span>
</span><span class="hll"><span class="n">LOCAL</span><span class="p">,</span>      <span class="n">bot2DSP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>       <span class="n">NULL</span><span class="p">,</span>       <span class="mi">18</span>
</span><span class="n">BEL</span><span class="p">,</span>        <span class="n">ConfigBits</span><span class="o">.</span><span class="n">vhdl</span>
<span class="n">MATRIX</span><span class="p">,</span>     <span class="n">DSP_top_switch_matrix</span><span class="o">.</span><span class="n">vhdl</span>
<span class="hll"><span class="n">EndTILE</span>
</span>
<span class="hll"><span class="n">SuperTILE</span>   <span class="n">DSP</span>     <span class="c1"># declace supetile DSP</span>
</span><span class="n">DSP_top</span>
<span class="n">DSP_bot</span>
<span class="hll"><span class="n">BEL</span><span class="p">,</span>        <span class="n">MUlADD</span><span class="o">.</span><span class="n">vhdl</span>
</span><span class="hll"><span class="n">EndTILE</span>
</span></pre></div>
</div>
<p>test</p>
</section>
</section>
</section>


        </div>
        <div class="side-doc-outline">
            <div class="side-doc-outline--content"> 
<div class="localtoc">
    <p class="caption">
      <span class="caption-text">Table Of Contents</span>
    </p>
    <ul>
<li><a class="reference internal" href="#">Fabric definition</a><ul>
<li><a class="reference internal" href="#fabric-csv-description">Fabric csv description</a></li>
<li><a class="reference internal" href="#fabric-layout">Fabric layout</a></li>
<li><a class="reference internal" href="#tiles">Tiles</a><ul>
<li><a class="reference internal" href="#wires">Wires</a></li>
<li><a class="reference internal" href="#switch-matrix">Switch matrix</a></li>
<li><a class="reference internal" href="#primitives">Primitives</a></li>
<li><a class="reference internal" href="#bitstream-remapping">Bitstream remapping</a></li>
</ul>
</li>
<li><a class="reference internal" href="#supertiles">Supertiles</a><ul>
<li><a class="reference internal" href="#modeling">Modeling</a></li>
<li><a class="reference internal" href="#supertile-functionality">Supertile Functionality</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
            </div>
        </div>

      <div class="clearer"></div>
    </div><div class="pagenation">
     <a id="button-prev" href="Building%20fabric.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="P">
         <i class="pagenation-arrow-L material-icons">arrow_back</i>
         <div class="pagenation-text">
            <span class="pagenation-direction">Previous</span>
            <div>Building fabric</div>
         </div>
     </a>
     <a id="button-next" href="ASIC/index.html" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored" role="botton" accesskey="N">
        <i class="pagenation-arrow-R material-icons">arrow_forward</i>
        <div class="pagenation-text">
            <span class="pagenation-direction">Next</span>
            <div>Fabric ASIC implementation</div>
        </div>
     </a>
  </div>
        <footer class="mdl-mini-footer">
    <div class="mdl-mini-footer__left-section">
      <div class="mdl-logo">FABulous Dokumentation</div>
      <div>
        
        <ul>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background and Features</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Usage.html">Quick start</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Building%20fabric.html">Building fabric</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fabric definition</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="ASIC/index.html">Fabric ASIC implementation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FPGA_CAD-tools/index.html">FPGA CAD-tool parameterization</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FPGA-to-bitstream/index.html">RTL to Bitstream</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="simulation/index.html">Simulation and emulation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references/index.html">Technical references</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gallery/index.html">Chip Gallery</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="definitions.html">Definitions and abbreviations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Team and contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
</ul>

      </div>
    </div>

    <div class="mdl-mini-footer__right-section">
        <div>&copy; Copyright 2021, University of Manchester.</div>
      <div>Generated by <a href="http://sphinx.pocoo.org/">Sphinx</a> 4.3.0 using <a href="https://github.com/myyasuda/sphinx_materialdesign_theme">sphinx_materialdesign_theme</a>.</div>
    </div>
</footer>
        </main>
    </div>
  </body>
</html>